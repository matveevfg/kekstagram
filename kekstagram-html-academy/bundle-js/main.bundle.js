(()=>{"use strict";const e=["gif","jpg","jpeg","png"],t=(e,t)=>e<0||t<0?-1:(t<e&&([e,t]=[t,e]),Math.floor(Math.random()*(t-e+1))+e),r=e=>e[t(0,e.length-1)],n=(e,r,o)=>{const c=t(r,o);return e.some((e=>e===c))&&n(e,r,o),c},o=(e,t)=>t[e%100>4&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]],c=e=>"Esc"===e.key||"Escape"===e.key,s=document.querySelector(".scale__control--value"),l=document.querySelector(".img-upload__preview img"),i=e=>"%"===e[e.length-1]?+e.slice(0,e.length-1):+e,a=e=>{s.value=`${e}%`,l.style=`transform: scale(${e/100})`},d=()=>{let e=i(s.value)-25;e<25&&(e=25),a(e)},u=()=>{let e=i(s.value)+25;e>100&&(e=100),a(e)},m={chrome:{min:0,max:1,step:.1,style:e=>`grayscale(${e})`},sepia:{min:0,max:1,step:.1,style:e=>`sepia(${e})`},marvin:{min:0,max:100,step:1,style:e=>`invert(${e}%)`},phobos:{min:0,max:3,step:.1,style:e=>`blur(${e}px)`},heat:{min:1,max:3,step:.1,style:e=>`brightness(${e})`},none:{min:0,max:100,step:1,style:()=>"none"}},p=document.querySelector(".effect-level"),v=p.querySelector(".effect-level__slider"),y=p.querySelector(".effect-level__value"),_=document.querySelector(".img-upload__preview img"),f={effect:"none",value:100},h=()=>{y.value=f.value,_.style.filter=m[f.effect].style(f.value),_.classList.forEach((e=>{e.includes("effects__preview--")&&_.classList.remove(e)})),_.classList.add(`effects__preview--${f.effect}`),"none"==f.effect?p.classList.add("visually-hidden"):p.classList.remove("visually-hidden")},g=e=>{const t=e.target.id.split("-")[1];f.effect=t,(e=>{v.noUiSlider.updateOptions({range:{min:m[e].min,max:m[e].max},start:m[e].max,step:m[e].step})})(t),h()},S=["Иван","Себастьян","Мария","Кристоф","Виктор","Юлия","Люпита","Вашингтон"],q=["Всё отлично!","В целом всё неплохо. Но не всё.","Когда вы делаете фотографию, хорошо бы убирать палец из кадра. В конце концов это просто непрофессионально.","Моя бабушка случайно чихнула с фотоаппаратом в руках и у неё получилась фотография лучше.","Я поскользнулся на банановой кожуре и уронил фотоаппарат на кота и у меня получилась фотография лучше.","Лица у людей на фотке перекошены, как будто их избивают. Как можно было поймать такой неудачный момент?!"],L=0,E=10,k=140;let w;const x=[],b=()=>{const e=[];let o;for(let c=0;c<t(L,E);c++){o=n(x,1,999),x.push(o);let c=new Array(2).fill(null).map((()=>r(q))).filter(((e,r)=>r?t(0,1):1)).reduce(((e,t)=>e.includes(t)?e:[...e,t]),[]).join(" ");e.push({id:o,avatar:`img/avatar-${t(1,6)}.svg`,message:c.substr(0,k),name:r(S)})}return e},$={hashtag:e=>C(e),description:e=>T(e)},C=e=>{if(!e.length)return;let t=e.toLowerCase().trim().split(/\s+/);if(t.length>5)return"Максимум 5 хэш-тегов";let r="";return t.some(((e,t,n)=>{"#"===e[0]?"#"!==e?e.indexOf("#",1)>=1?r="Хэш-теги разделяются пробелами":e.length>20?r="Максимальная длина одного хэш-тега 20 символов, включая решетку":n.indexOf(e,t+1)>=t+1?r="Хэш-теги не должны повторяться":/[^a-z0-9а-я#]/.test(e)&&(r="Строка после решётки должна состоять только из букв и чисел"):r="Хеш-тег не может состоять только из одной решётки":r="Хэш-тег начинается с символа # (решётка)"})),r},T=e=>{const t=e.trim().length;if(t>k)return`Превышен лимит символов: 140. Удалите ${t-k} ${o(t-k,["символ","символа","символов"])}.`},D=(e,t)=>{e.setCustomValidity(""),e.style.border="none";const r=$[t](e.value);r?(e.setCustomValidity(r),e.style.border="2px solid red"):e.style.border="none",e.reportValidity()},F=document.querySelector("#error-receive").content.querySelector(".error"),j=document.querySelector("#success").content.querySelector(".success"),M=document.querySelector("#error").content.querySelector(".error"),A=(e,t)=>{const r=document.createDocumentFragment(),n=e.cloneNode(!0);return n.classList.add("modal-show-active"),t&&(n.querySelector(".error__title").textContent=t),r.appendChild(n),r},O=()=>new Promise((e=>{setTimeout((()=>{document.querySelector(".modal-show-active").remove(),e()}),3e3)})),U=e=>{document.body.append(A(M,e)),O()},N={GET:"https://23.javascript.pages.academy/kekstagram/data",POST:"https://23.javascript.pages.academy/kekstagram"},P={400:"Неверный запрос",401:"Пользователь не авторизован",404:"Страница не найдена",500:"Внутренняя ошибка сервера"},V=(e,t,r,n)=>{fetch(N[r],{method:r,body:n}).then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} (${P[e.status]?P[e.status]:e.statusText})`)})).then((t=>{e(t)})).catch((e=>{t(e)}))},G=document.querySelector("body"),H=G.querySelector(".img-upload__form"),I=H.querySelector("#upload-file"),R=H.querySelector(".img-upload__overlay"),z=H.querySelector(".img-upload__cancel"),W=H.querySelector(".img-upload__preview img"),B=H.querySelectorAll(".effects__preview"),J=H.querySelector(".img-upload__scale"),K=J.querySelector(".scale__control--value"),Q=J.querySelector(".scale__control--smaller"),X=J.querySelector(".scale__control--bigger"),Y=document.querySelector(".img-upload__effects"),Z=document.querySelector(".text__hashtags"),ee=document.querySelector(".text__description"),te=()=>{K.value="100%",W.style="",f.effect="none",f.value=100,h(),window.noUiSlider.create(v,{range:{min:m[f.effect].min,max:m[f.effect].max},start:m[f.effect].max,step:m[f.effect].step,connect:"lower",format:{to:e=>Number.isInteger(e)?e.toFixed(0):e.toFixed(1),from:e=>parseFloat(e)}}),v.noUiSlider.on("update",((e,t)=>{f.value=e[t],h()})),G.classList.add("modal-open"),R.classList.remove("hidden"),document.addEventListener("keydown",ce),z.addEventListener("click",re),Q.addEventListener("click",d),X.addEventListener("click",u),Y.addEventListener("change",g),Z.addEventListener("input",ne),ee.addEventListener("input",oe),H.addEventListener("submit",le)},re=()=>{R.classList.add("hidden"),G.classList.remove("modal-open"),I.value="",v.noUiSlider.destroy(),document.removeEventListener("keydown",ce),z.removeEventListener("click",re),Q.removeEventListener("click",d),X.removeEventListener("click",u),Y.removeEventListener("change",g),Z.removeEventListener("input",ne),ee.removeEventListener("input",oe),H.removeEventListener("submit",le)},ne=()=>D(Z,"hashtag"),oe=()=>D(ee,"description"),ce=e=>{c(e)&&(e.preventDefault(),document.activeElement.matches(".text__hashtags")||document.activeElement.matches(".text__description")||re())},se=()=>{re(),document.body.append(A(j)),O()},le=e=>{e.preventDefault(),V(se,U,"POST",new FormData(e.target))};I.addEventListener("change",(()=>{(t=>{const r=t.files[0],n=r.name.toLowerCase();return new Promise(((t,o)=>{if(e.some((e=>n.endsWith(e)))){const e=new FileReader;e.readAsDataURL(r),e.addEventListener("load",(()=>t(e.result)),{once:!0})}else o("Неверный формат файла")}))})(I).then((e=>{return t=e,W.src=t,void B.forEach((e=>{e.style.backgroundImage=`url(${t})`}));var t})).then((()=>te())).catch((e=>U(e)))}));const ie=document.querySelector(".big-picture"),ae=document.querySelector(".big-picture__cancel"),de=document.querySelector(".overlay"),ue=ie.querySelector(".social"),me=ue.querySelector(".social__comments"),pe=ue.querySelector(".social__comment-count"),ve=ue.querySelector(".social__comments-loader"),ye=document.querySelector("#comment").content.querySelector(".social__comment");let _e=0;const fe=e=>{e?(pe.classList.add("hidden"),ve.classList.add("hidden")):(pe.classList.remove("hidden"),ve.classList.remove("hidden"))},he=e=>{const t=document.createDocumentFragment();return e.forEach((e=>{t.appendChild((e=>{const t=ye.cloneNode(!0);return t.querySelector(".social__picture").src=e.avatar,t.querySelector(".social__picture").alt=e.name,t.querySelector(".social__picture").title=e.name,t.querySelector(".social__text").textContent=e.message,t})(e))})),t},ge=e=>{if(e.length>0&&(_e?(me.appendChild(he(e.slice(_e,_e+5))),_e+=5):(me.appendChild(he(e.slice(0,5))),_e=5),e.length>Math.max(5,_e)))return fe(!1),pe.innerHTML=`${_e} из <span class="comments-count">${e.length}</span> ${o(e.length,["комментария","комментариев","комментариев"])}`,void ve.addEventListener("click",(e=>{ge(e)}).bind(null,e),{once:!0});fe(!0)},Se=()=>{ie.classList.add("hidden"),document.querySelector("body").classList.remove("modal-open"),ae.removeEventListener("click",Se),document.removeEventListener("keydown",qe),de.removeEventListener("click",Le)},qe=e=>{c(e)&&(e.preventDefault(),Se())},Le=e=>{e.target.closest(".big-picture__preview")||Se()},Ee=document.querySelector("#picture").content.querySelector(".picture"),ke=document.querySelector(".pictures"),we=(e,t)=>{const r=document.createDocumentFragment();e.forEach((e=>{r.appendChild((e=>{const t=Ee.cloneNode(!0);return t.querySelector(".picture__img").src=e.url,t.querySelector(".picture__comments").textContent=e.comments.length,t.querySelector(".picture__likes").textContent=e.likes,t.addEventListener("click",(t=>{t.preventDefault(),(e=>{(e=>{ie.querySelector(".big-picture__img img").src=e.url,ue.querySelector(".likes-count").textContent=e.likes,ue.querySelector(".social__caption").textContent=e.description,me.innerHTML="",_e=0,ge(e.comments)})(e),ie.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),ae.addEventListener("click",Se),document.addEventListener("keydown",qe),de.addEventListener("click",Le)})(e)})),t})(e))})),ke.appendChild(r),De(),t&&t()};let xe;const be=document.querySelector(".img-filters"),$e=be.querySelector(".img-filters__form"),Ce=$e.querySelectorAll(".img-filters__button");let Te;const De=()=>{be.classList.remove("img-filters--inactive")},Fe=(e=>{let t=null;return(...e)=>{t&&window.clearTimeout(t),t=window.setTimeout((()=>{(e=>{let t=Te;switch(ke.querySelectorAll(".picture").forEach((e=>{e.remove()})),e){case"filter-random":t=(e=>{for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e})(Te.slice()).slice(0,10);break;case"filter-discussed":t=Te.slice().sort(((e,t)=>t.comments.length-e.comments.length))}we(t)})(...e)}),500)}})();$e.addEventListener("click",(e=>{const t=e.target,r=$e.querySelector(".img-filters__button--active");Te||(Te=xe||w),t.classList.contains("img-filters__button")&&(t.id===r.id&&"filter-random"!==t.id||(t.id!==r.id&&(Ce.forEach((e=>{e.classList.remove("img-filters__button--active")})),t.classList.add("img-filters__button--active")),Fe(t.id)))})),V((e=>{xe=e,we(e)}),(e=>{(e=>(document.body.append(A(F,e)),O()))(e).then((()=>{w=new Array(25).fill(null).map(((e,r)=>({id:r+1,url:`photos/${r+1}.jpg`,description:`Описание #${r+1}`,likes:t(15,200),comments:b()})))})).then((()=>we(w)))}),"GET")})();
//# sourceMappingURL=main.bundle.js.map